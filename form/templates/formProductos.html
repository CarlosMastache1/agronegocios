{% load static %}

<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">
    <title>Registro de Productor</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js" defer></script>





      <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">

      <link rel="stylesheet" type="text/css" href="{% static 'css/style-layout.css' %}">

    <style>
        body {
            display: flex;

            justify-content: center;
            align-items: center;
            background: white;
            font-family: 'Roboto', sans-serif;
        }

        .container {
            display: flex;
            width: 90%;
            max-width: 1200px;
            background: white;
            border-radius: 10px;
            box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .left-section {
            flex: 1;
            background: url("{% static 'images/fondoForm.jpg' %}") no-repeat center center;
            background-size: cover;
            min-height: 315px;
        }

        .right-section {
            flex: 1.5;
            padding: 40px;
            background: white;
            color: black;
        }

        h4 {
            color: #9D2449;
            text-align: center;
        }

        .input-field input,
        .input-field select,
        .file-path {
            border-bottom: 2px solid #9D2449 !important;
            color: black;
        }

        label {
            color: black !important;
        }

        .btn {
            background: #9D2449;
            color: white;
            width: 100%;
            border-radius: 25px;
            transition: background 0.3s ease;
        }

        .btn2 {
            background: #42b147;
            color: white;
            width: 100%;
            border-radius: 25px;
            transition: background 0.3s ease;
        }

        .btn2:hover {
            background: #60d366;
        }

        .btn:hover {
            background: #B5305A;
        }

        .icon {
            color: #9D2449;
            font-size: 24px;
            margin-right: 10px;
        }

        #aletar_pdf {
            color: red;
            font-size: 10px;
        }
    </style>
</head>

<body>
         <header class="site-header">
      <!-- Navbar -->
      <nav class="navbar navbar-default navbar-fixed-top fluid-navbar navbar-layaout-new" id="navbar-new">
        <div class="container-fluid">


          <!-- Encabezado con botón toggle -->
          <div class="navbar-header">
            <a class="navbar-brand" href="#">
              <img src="{% static 'assets/images/logo-new.png' %}" alt="logo" height="40px">
            </a>
            <!-- Botón para colapsar menú -->
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu-colapsable">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
          </div>


          <div class="collapse navbar-collapse" id="menu-colapsable">
            <ul class="nav navbar-nav navbar-right">

              <li>
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <span class="glyphicon glyphicon-home"></span> INICIO <span
                    class="glyphicon glyphicon-chevron-down pull-right"></span>
                </a>
                <ul class="dropdown-menu">
                  <li><a href="/">INICIO</a></li>
                  <li><a href="/nosotros">NOSOTROS</a></li>
                  <li><a href="/directorio">DIRECTORIO</a></li>
                  <li><a href="/ubicacion">UBICACION</a></li>
                </ul>
              </li>

              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <span class="glyphicon glyphicon-lock"></span> DESEMPEÑO DE GARANTÍAS LÍQUIDAS <span
                    class="glyphicon glyphicon-chevron-down pull-right"></span>
                </a>
                <ul class="dropdown-menu">
                  <li><a href="/graficaPubli" target="_blank">VER DESEMPEÑO DEL FONDO</a></li>
                  <li><a href="/login" target="_blank">HERRAMIENTA PARA INTERMEDIARIOS FINANCIEROS</a></li>
                </ul>
              </li>

              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <span class="glyphicon glyphicon-stats"></span> ESTADÍSTICAS DEL SECTOR AGROALIMENTARIO <span
                    class="glyphicon glyphicon-chevron-down pull-right"></span>
                </a>
                <ul class="dropdown-menu">
                  <li><a href="/agricola">AGRICOLA</a></li>
                  <li><a href="/pecuario">PECUARIO</a></li>
                </ul>
              </li>

              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <span class="glyphicon glyphicon-road"></span> DESARROLLO DE MERCADO <span
                    class="glyphicon glyphicon-chevron-down pull-right"></span>
                </a>
                <ul class="dropdown-menu">
                  <li><a href="/formProductos" target="_blank">REGISTRA TU PRODUCTO</a></li>
                  <li><a href="/tiendaHome">CATALOGO DE PRODUCTOS</a></li>
                  <li><a href="/graficos-precios">COTIZACIÓN DE PRECIOS</a></li>
                </ul>
              </li>

            </ul>
          </div>
        </div>
      </nav>


    </header>
    <div class="container" style="padding-top: 65px;">
        <div class="left-section"></div>
        <div class="right-section">
            <div class="center-align">
                <img src="{% static 'images/logoForm.png' %}" alt="Logo" width="300">
            </div>
      <h4>{% if modo == 'editar' %}EDITAR PRODUCTO{% else %}REGISTRAR PRODUCTO{% endif %}</h4>
         <form action="{% if modo == 'editar' %}{% url 'productos_update' obj.pk %}{% else %}{% url 'formProductos' %}{% endif %}"
            method="POST" enctype="multipart/form-data">
      {% csrf_token %}
    <h5 >DATOS DEL PRODUCTOR</h5>

                <div class="input-field">
                    <input name="nombreProductor" type="text" id="nombre-productor" required value="{{ obj.nombreProductor|default_if_none:'' }}"
                        oninput="this.value = this.value.toUpperCase();">
                    <label for="nombre-productor">NOMBRE DEL PRODUCTOR</label>
                </div>
                <div class="input-field">
                    <select  required name="municipio">
                        <option value="" disabled {% if not obj %}selected{% endif %}>ELIGE UNA OPCIÓN</option>
                        {% for mun in muni %}
                        <option value="{{mun.id}}" {% if obj and obj.municipio_id == mun.id %}selected{% endif %}>{{mun.nombre_municipio}}</option>
                        {% endfor %}
                    </select>
                    <label>MUNICIPIO</label>
                </div>
                <div class="input-field">
                    <input type="text" id="localidad" name="localidad"  value="{{ obj.localidad|default_if_none:'' }}" oninput="this.value = this.value.toUpperCase();">
                    <label for="localidad">LOCALIDAD</label>
                </div>
                                <div class="input-field">
                    <input name="telefono" type="tel" pattern="[0-9]{10}" maxlength="10" id="telefono" value="{{ obj.telefono|default_if_none:'' }}">
                    <label for="telefono">NÚMERO TELEFÓNICO</label>
                </div>
                <div class="input-field">
                    <input name="email" type="email" id="email" required value="{{ obj.email|default_if_none:'' }}">
                    <label for="email">CORREO ELECTRÓNICO</label>
                </div>
                    
    <div id="productos-container">
        <div class="producto-form">
            <h5 style="color: #136817; font-weight: bolder;">DATOS DEL PRODUCTO</h5>
                <div class="input-field">
                    <input type="text" name="nombreProducto[]" id="nombre-producto" required value="{{ obj.nombreProducto|default_if_none:'' }}"
                        oninput="this.value = this.value.toUpperCase();">
                    <label for="nombre-producto">NOMBRE DEL PRODUCTO</label>
                </div>
                <div class="input-field">
                    <input type="text" name="nombreMarca[]" id="nombre-marca" value="{{ obj.nombreMarca|default_if_none:'' }}"
                        oninput="this.value = this.value.toUpperCase();">
                    <label for="nombre-marca">NOMBRE DE LA MARCA</label>
                </div>
                <div class="input-field">
                    <select name="subsector[]" class="subsector" required>
                        <option value="0" disabled {% if not obj %}selected{% endif %} >ELIGE UNA OPCIÓN</option>
                        <option value="AGRICOLA"  {% if obj and obj.subsector == 'AGRICOLA' %}selected{% endif %}>AGRICOLA</option>
                        <option value="PECUARIO"  {% if obj and obj.subsector == 'PECUARIO' %}selected{% endif %}>PECUARIO</option>
                        <option value="PESQUERO"  {% if obj and obj.subsector == 'PESQUERO' %}selected{% endif %}>PESQUERO</option>
                        <option value="ACUICOLA"  {% if obj and obj.subsector == 'ACUICOLA' %}selected{% endif %}>ACUICOLA</option>
                        <option value="FORESTAL"  {% if obj and obj.subsector == 'FORESTAL' %}selected{% endif %}>FORESTAL</option>
                        <option value="AGROINDUSTRIAL"  {% if obj and obj.subsector == 'AGROINDUSTRIAL' %}selected{% endif %}>AGROINDUSTRIAL</option>

                    </select>
                    <label>SUBSECTOR</label>
                </div> <br>
                <div class="sub-AGRICOLA categoria-container" style="display:none" >
                    <div class="input-field">
                        <select name="categoria[]" required>
<option value="" disabled {% if not obj or not obj.categoria %}selected{% endif %}>ELIGE UNA OPCIÓN</option>
                  <option value="AGUACATE" {% if obj and obj.categoria == 'AGUACATE' %}selected{% endif %}>AGUACATE</option>
                  <option value="AJONJOLI" {% if obj and obj.categoria == 'AJONJOLI' %}selected{% endif %}>AJONJOLI</option>
                  <option value="CAFE" {% if obj and obj.categoria == 'CAFE' %}selected{% endif %}>CAFE</option>
                  <option value="JENGIBRE" {% if obj and obj.categoria == 'JENGIBRE' %}selected{% endif %}>JENGIBRE</option>
                  <option value="LIMON" {% if obj and obj.categoria == 'LIMON' %}selected{% endif %}>LIMON</option>
                  <option value="MAIZ" {% if obj and obj.categoria == 'MAIZ' %}selected{% endif %}>MAIZ</option>
                  <option value="MANGO" {% if obj and obj.categoria == 'MANGO' %}selected{% endif %}>MANGO</option>
                  <option value="PAPAYA" {% if obj and obj.categoria == 'PAPAYA' %}selected{% endif %}>PAPAYA</option>
                  <option value="PEPINO" {% if obj and obj.categoria == 'PEPINO' %}selected{% endif %}>PEPINO</option>
                  <option value="TOMATE" {% if obj and obj.categoria == 'TOMATE' %}selected{% endif %}>TOMATE</option>
                  <option value="OTRO" {% if obj and obj.categoria == 'OTRO' %}selected{% endif %}>OTRO</option>
                        </select>
                        <label>CATEGORIA</label>
                    </div>
                </div>
                <div  class="sub-PECUARIO categoria-container" style="display:none">
                    <div class="input-field">
                    <select name="categoria[]" required>
<option value="" disabled {% if not obj or not obj.categoria %}selected{% endif %}>ELIGE UNA OPCIÓN</option>
                  <option value="APICOLA" {% if obj and obj.categoria == 'APICOLA' %}selected{% endif %}>APICOLA</option>
                  <option value="AVICOLA" {% if obj and obj.categoria == 'AVICOLA' %}selected{% endif %}>AVICOLA</option>
                  <option value="BOVINO" {% if obj and obj.categoria == 'BOVINO' %}selected{% endif %}>BOVINO</option>
                  <option value="CAPRINO" {% if obj and obj.categoria == 'CAPRINO' %}selected{% endif %}>CAPRINO</option>
                  <option value="PORCINO" {% if obj and obj.categoria == 'PORCINO' %}selected{% endif %}>PORCINO</option>

                        </select>
                        <label>CATEGORIA</label>
                    </div>
                </div>
                <div class="sub-PESQUERO categoria-container" style="display:none">
                    <div class="input-field">
                        <select name="categoria[]" required>
<option value="" disabled {% if not obj or not obj.categoria %}selected{% endif %}>ELIGE UNA OPCIÓN</option>
                  <option value="BARRILETE" {% if obj and obj.categoria == 'BARRILETE' %}selected{% endif %}>BARRILETE</option>
                  <option value="CAMARON CAFE" {% if obj and obj.categoria == 'CAMARON CAFE' %}selected{% endif %}>CAMARON CAFE</option>
                  <option value="CAZON" {% if obj and obj.categoria == 'CAZON' %}selected{% endif %}>CAZON</option>
                  <option value="OTRO" {% if obj and obj.categoria == 'OTRO' %}selected{% endif %}>OTRO</option>

                        </select>
                        <label>CATEGORIA</label>
                    </div>
                </div>
                <div class="sub-ACUICOLA categoria-container" style="display:none">
                    <div class="input-field">
                      <select name="categoria[]" required>
<option value="" disabled {% if not obj or not obj.categoria %}selected{% endif %}>ELIGE UNA OPCIÓN</option>
                  <option value="TILAPIA" {% if obj and obj.categoria == 'TILAPIA' %}selected{% endif %}>TILAPIA</option>
                  <option value="CAMARON BLANCO" {% if obj and obj.categoria == 'CAMARON BLANCO' %}selected{% endif %}>CAMARON BLANCO</option>
                  <option value="TRUCHA ARCOIRIS" {% if obj and obj.categoria == 'TRUCHA ARCOIRIS' %}selected{% endif %}>TRUCHA ARCOIRIS</option>
                  <option value="OTRO" {% if obj and obj.categoria == 'OTRO' %}selected{% endif %}>OTRO</option>

                        </select>
                        <label>CATEGORIA</label>
                    </div>
                </div>
                                <div class="sub-AGROINDUSTRIAL categoria-container" style="display:none">
                    <div class="input-field">
                        <select name="categoria[]" required>
<option value="" disabled {% if not obj or not obj.categoria %}selected{% endif %}>ELIGE UNA OPCIÓN</option>
                  <option value="CAFE" {% if obj and obj.categoria == 'CAFE' %}selected{% endif %}>CAFE</option>
                  <option value="MEZCAL" {% if obj and obj.categoria == 'MEZCAL' %}selected{% endif %}>MEZCAL</option>
                  <option value="MIEL" {% if obj and obj.categoria == 'MIEL' %}selected{% endif %}>MIEL</option>
                  <option value="CHOCOLATE" {% if obj and obj.categoria == 'CHOCOLATE' %}selected{% endif %}>CHOCOLATE</option>
                  <option value="PIÑA ENLATADA" {% if obj and obj.categoria == 'PIÑA ENLATADA' %}selected{% endif %}>PIÑA ENLATADA</option>
                  <option value="AJONJOLI" {% if obj and obj.categoria == 'AJONJOLI' %}selected{% endif %}>AJONJOLI</option>
        
                </select>
                        <label>CATEGORIA</label>
                    </div>
                </div>
                                <div class="input-field" style="padding-top: 10px;">
                    <select name="unidad_medidad[]" required >
                <option value="0" disabled {% if not obj %}selected{% endif %}>ELIGE UNA OPCIÓN</option>
                <option value="TONELADA" {% if obj and obj.unidad_medidad == 'TONELADA' %}selected{% endif %}>TONELADA</option>
                <option value="KILOGRAMOS" {% if obj and obj.unidad_medidad == 'KILOGRAMOS' %}selected{% endif %}>KILOGRAMOS</option>
                <option value="LITROS" {% if obj and obj.unidad_medidad == 'LITROS' %}selected{% endif %}>LITROS</option>
                <option value="PIEZAS" {% if obj and obj.unidad_medidad == 'PIEZAS' %}selected{% endif %}>PIEZAS</option>


                    </select>
                    <label style="padding-top: 10px;">UNIDAD DE MEDIDA</label>
                </div>
                <div class="input-field">
                    <input type="text" id="numero" oninput="formatearNumero(this)" value="{{ obj.volumen_produccion|default_if_none:'' }}" />
                    <input name="volumen_produccion[]" type="hidden" id="volumen" required
                        oninput="this.value = this.value.toUpperCase();" value="{{ obj.volumen_produccion|default_if_none:'' }}">
                    <label for="volumen">VOLUMEN DE PRODUCCIÓN</label> 
                </div>

                <div class="input-field">
                <select name="disponibilidad_entrega[]" required>
                <option value="0" disabled {% if not obj %}selected{% endif %}>ELIGE UNA OPCIÓN</option>
                <option value="SEMANAL" {% if obj and obj.disponibilidad_entrega == 'SEMANAL' %}selected{% endif %}>SEMANAL</option>
                <option value="MENSUAL" {% if obj and obj.disponibilidad_entrega == 'MENSUAL' %}selected{% endif %}>MENSUAL</option>
                <option value="BIMESTRAL" {% if obj and obj.disponibilidad_entrega == 'BIMESTRAL' %}selected{% endif %}>BIMESTRAL</option>
                <option value="TRIMESTRAL" {% if obj and obj.disponibilidad_entrega == 'TRIMESTRAL' %}selected{% endif %}>TRIMESTRAL</option>
                <option value="CUATRIMESTRAL" {% if obj and obj.disponibilidad_entrega == 'CUATRIMESTRAL' %}selected{% endif %}>CUATRIMESTRAL</option>
                <option value="SEMESTRAL" {% if obj and obj.disponibilidad_entrega == 'SEMESTRAL' %}selected{% endif %}>SEMESTRAL</option>
                <option value="ANUAL" {% if obj and obj.disponibilidad_entrega == 'ANUAL' %}selected{% endif %}>ANUAL</option>

                    </select>
                    <label style="padding-top: 10px;">DISPONIBILIDAD DE ENTREGA</label>
                </div>

                <div class="file-field input-field">
                    <div class="btn">
                        <span>SUBIR FOTO DEL PRODUCTO</span>
                        <input type="file" name="imagenProd[]" multiple accept="image/png, image/jpeg">
                    </div>
                    <div class="file-path-wrapper">
                        <input class="file-path validate" type="text" placeholder="SUBIR FOTO DEL PRODUCTO">
                    </div>
                                {% if obj and obj.imagenProd %}
                <p>Actual: <a href="{{ obj.imagenProd.url }}" target="_blank">Ver imagen</a></p>
              {% endif %}
                </div>


                <div class="file-field input-field">
                    <div class="btn">
                        <span>SUBIR CERTIFICADO PDF</span>
                        <input type="file" name="archivo_pdf[]" accept="application/pdf" id="archivo-pdf">
                    </div>
                    <div class="file-path-wrapper">
                        <input class="file-path validate" type="text" placeholder="SUBIR CERTIFICADO PDF">
                    </div>
                        {% if obj and obj.archivo_pdf %}
                            <p>Actual: <a href="{{ obj.archivo_pdf.url }}" target="_blank">ver PDF</a></p>
                        {% endif %}
                    <span id="aletar_pdf"></span>
                </div>

    <div class="input-field">
  <textarea id="mensaje" class="materialize-textarea" name="comentarios[]"> {{ obj.comentarios|default_if_none:'' }} </textarea>
  <label for="comentarios">COMENTARIOS</label>
</div>
</div>
</div>

                
                {% if modo != 'editar' %}
                <button type="button" onclick="agregarProducto()" class="btn2 waves-effect waves-light" style="padding-bottom: 8px;">
                AGREGAR OTRO PRODUCTO
                </button>
                {% endif %}
<br><br>
                <label>
                    <input type="checkbox" name="terminos" required />
                    <span style="padding-bottom: 40px;">Acepto los <a href="/terminos-condiciones"
                            target="_blank">términos y condiciones</a></span>
                </label>


        <button class="btn waves-effect waves-light" style="padding-top: 10px;">
          {% if modo == 'editar' %}GUARDAR CAMBIOS{% else %}REGISTRAR PRODUCTO{% endif %}
        </button>
            </form>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>

  <script>
    //navbar-layaout-new 
    const navbar = document.getElementById('navbar-new');

    window.addEventListener('scroll', () => {
      if (window.scrollY > 50) {
        navbar.classList.remove('navbar-layaout-new');
        navbar.classList.add('navbar-scroll');
      } else {
        navbar.classList.remove('navbar-scroll');
        navbar.classList.add('navbar-layaout-new');
      }
    });

  </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            M.FormSelect.init(document.querySelectorAll('select'));
        });
    </script>
    <script src="{% static 'js/select3.js' %}"></script>


    <script>
    // Solo números y un punto en el hidden volumen
    const inputHiddenVol = document.getElementById("volumen");
    if (inputHiddenVol) {
      inputHiddenVol.addEventListener("input", function () {
        this.value = this.value.replace(/[^0-9.]/g, '');
        const parts = this.value.split('.');
        if (parts.length > 2) {
          this.value = parts[0] + '.' + parts.slice(1).join('');
        }
      });
    }


        // Solo dígitos en teléfono
    const phoneInput = document.getElementById("telefono");
    if (phoneInput) {
      phoneInput.addEventListener("input", function () {
        this.value = this.value.replace(/\D/g, '');
      });
    }

        const tamano_maximo = 100000000; // 100mb

        const spanAlert = document.getElementById("aletar_pdf");

        const inputFile = document.getElementById('archivo-pdf');
            if (inputFile) {
      inputFile.addEventListener("change", function () {
        if (this.files.length <= 0) return;
        const archvo = this.files[0];
        if (archvo.size >= tamano_maximo) {
          inputFile.value = "";
          if (spanAlert) spanAlert.innerHTML = "El certificado es muy pesado; asegúrate de que el archivo no exceda 100MB";
        } else {
          if (spanAlert) spanAlert.innerHTML = "";
        }
      });
    }

    </script>


    <script>
    // Formateo visible con comas y sincroniza al hidden
    function formatearNumero(input) {
      let valor = (input.value || '').toString().replace(/[^0-9]/g, '');
      document.getElementById('volumen').value = valor;
      input.value = valor.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }
    </script>




</body>

</html>
